/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsx as m,jsxs as P}from"@dropins/tools/preact-jsx-runtime.js";import{c as C,a as w,s as x}from"../chunks/emailConsent.js";import{classes as E}from"@dropins/tools/lib.js";import*as b from"@dropins/tools/preact-compat.js";import{Suspense as L,lazy as r,useState as $,useRef as S}from"@dropins/tools/preact-compat.js";import{useState as y,useEffect as D}from"@dropins/tools/preact-hooks.js";import"@dropins/tools/fetch-graphql.js";const T=e=>b.createElement("svg",{id:"Icon_Check_Base","data-name":"Icon \\u2013 Check \\u2013 Base",xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",...e},b.createElement("g",{id:"Large"},b.createElement("rect",{id:"Placement_area","data-name":"Placement area",width:24,height:24,fill:"#fff",opacity:0}),b.createElement("g",{id:"Check_icon","data-name":"Check icon",transform:"translate(303.874 1434.583)"},b.createElement("path",{vectorEffect:"non-scaling-stroke",id:"Path_884137","data-name":"Path 884137",d:"M148,494.611l4.248,4.244,8.538-8.522",transform:"translate(-446.265 -1917.177)",fill:"none",stroke:"currentColor"})))),U=Object.freeze(Object.defineProperty({__proto__:null,default:T},Symbol.toStringTag,{value:"Module"})),j=function(){const o=typeof document<"u"&&document.createElement("link").relList;return o&&o.supports&&o.supports("modulepreload")?"modulepreload":"preload"}(),B=function(e){return"/"+e},O={},i=function(o,s,a){let u=Promise.resolve();if(s&&s.length>0){document.getElementsByTagName("link");const n=document.querySelector("meta[property=csp-nonce]"),c=(n==null?void 0:n.nonce)||(n==null?void 0:n.getAttribute("nonce"));u=Promise.allSettled(s.map(t=>{if(t=B(t),t in O)return;O[t]=!0;const l=t.endsWith(".css"),h=l?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${t}"]${h}`))return;const _=document.createElement("link");if(_.rel=l?"stylesheet":j,l||(_.as="script"),_.crossOrigin="",_.href=t,c&&_.setAttribute("nonce",c),document.head.appendChild(_),l)return new Promise((f,v)=>{_.addEventListener("load",f),_.addEventListener("error",()=>v(new Error(`Unable to preload CSS for ${t}`)))})}))}function d(n){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=n,window.dispatchEvent(c),!c.defaultPrevented)throw n}return u.then(n=>{for(const c of n||[])c.status==="rejected"&&d(c.reason);return o().catch(d)})},N=e=>e.reduce((s,a)=>{if(!a)return s;if(typeof a=="string"&&(s+=` ${a}`),Array.isArray(a)){const[u,d]=a;u&&d&&(s+=` ${u}`)}return s},"").trim(),R={Add:r(()=>i(()=>import("../chunks/Add.js"),[])),Bulk:r(()=>i(()=>import("../chunks/Bulk.js"),[])),Burger:r(()=>i(()=>import("../chunks/Burger.js"),[])),Cart:r(()=>i(()=>import("../chunks/Cart.js"),[])),Check:r(()=>i(()=>Promise.resolve().then(()=>U),void 0)),ChevronDown:r(()=>i(()=>import("../chunks/ChevronDown.js"),[])),ChevronUp:r(()=>i(()=>import("../chunks/ChevronUp.js"),[])),ChevronRight:r(()=>i(()=>import("../chunks/ChevronRight.js"),[])),Close:r(()=>i(()=>import("../chunks/Close.js"),[])),Heart:r(()=>i(()=>import("../chunks/Heart.js"),[])),Minus:r(()=>i(()=>import("../chunks/Minus.js"),[])),Placeholder:r(()=>i(()=>import("../chunks/Placeholder.js"),[])),PlaceholderFilled:r(()=>i(()=>import("../chunks/PlaceholderFilled.js"),[])),Search:r(()=>i(()=>import("../chunks/Search.js"),[])),SearchFilled:r(()=>i(()=>import("../chunks/SearchFilled.js"),[])),Sort:r(()=>i(()=>import("../chunks/Sort.js"),[])),Star:r(()=>i(()=>import("../chunks/Star.js"),[])),View:r(()=>i(()=>import("../chunks/View.js"),[])),User:r(()=>i(()=>import("../chunks/User.js"),[])),Warning:r(()=>i(()=>import("../chunks/Warning.js"),[])),Locker:r(()=>i(()=>import("../chunks/Locker.js"),[])),Wallet:r(()=>i(()=>import("../chunks/Wallet.js"),[])),Card:r(()=>i(()=>import("../chunks/Card.js"),[])),Order:r(()=>i(()=>import("../chunks/Order.js"),[])),Delivery:r(()=>i(()=>import("../chunks/Delivery.js"),[])),OrderError:r(()=>i(()=>import("../chunks/OrderError.js"),[])),OrderSuccess:r(()=>i(()=>import("../chunks/OrderSuccess.js"),[])),PaymentError:r(()=>i(()=>import("../chunks/PaymentError.js"),[])),CheckWithCircle:r(()=>i(()=>import("../chunks/CheckWithCircle.js"),[])),WarningWithCircle:r(()=>i(()=>import("../chunks/WarningWithCircle.js"),[])),WarningFilled:r(()=>i(()=>import("../chunks/WarningFilled.js"),[])),InfoFilled:r(()=>i(()=>import("../chunks/InfoFilled.js"),[])),HeartFilled:r(()=>i(()=>import("../chunks/HeartFilled.js"),[])),Trash:r(()=>i(()=>import("../chunks/Trash.js"),[])),Eye:r(()=>i(()=>import("../chunks/Eye.js"),[])),EyeClose:r(()=>i(()=>import("../chunks/EyeClose.js"),[])),Date:r(()=>i(()=>import("../chunks/Date.js"),[])),AddressBook:r(()=>i(()=>import("../chunks/AddressBook.js"),[])),EmptyBox:r(()=>i(()=>import("../chunks/EmptyBox.js"),[])),Coupon:r(()=>i(()=>import("../chunks/Coupon.js"),[])),Gift:r(()=>i(()=>import("../chunks/Gift.js"),[])),GiftCard:r(()=>i(()=>import("../chunks/GiftCard.js"),[])),Edit:r(()=>i(()=>import("../chunks/Edit.js"),[]))};function k(e){try{if(e.startsWith("//")){const s=`${window.location.protocol}${e}`;return new URL(s).hostname!==window.location.hostname?(console.error(`[Icon] External URL rejected for security: ${e} - Only same-domain URLs are allowed`),!1):!0}return new URL(e).hostname!==window.location.hostname?(console.error(`[Icon] External URL rejected for security: ${e} - Only same-domain URLs are allowed`),!1):!0}catch{return console.error(`[Icon] Invalid URL format: ${e}`),!1}}function W({url:e,...o}){const[s,a]=y(""),[u,d]=y(!0),[n,c]=y(!1);return D(()=>{fetch(e).then(t=>{if(!t.ok)throw console.error(`[Icon] Failed to fetch SVG: ${t.status} ${t.statusText}`),n;return t.text()}).then(t=>{try{if(!new DOMParser().parseFromString(t,"image/svg+xml").querySelector("svg"))throw new Error("No <svg> element found")}catch(h){h instanceof Error?console.error(`[Icon] Invalid SVG content from ${e}: ${h.message}`):console.error(`[Icon] Invalid SVG content from ${e}: ${String(h)}`),c(!0),d(!1)}let l=t;o.width&&(l=l.replace(/<svg([^>]*)\s+width\s*=\s*["'][^"']*["']/gi,"<svg$1"),l=l.replace(/<svg/i,`<svg width="${o.width}"`)),o.height&&(l=l.replace(/<svg([^>]*)\s+height\s*=\s*["'][^"']*["']/gi,"<svg$1"),l=l.replace(/<svg/i,`<svg height="${o.height}"`)),o.title&&(l=l.replace(/<title[^>]*>.*?<\/title>/gi,""),l=l.replace(/<svg([^>]*)>/i,`<svg$1><title>${o.title}</title>`)),a(l),d(!1)}).catch(t=>{t instanceof Error?console.error(`[Icon] ${t.message}`):console.error(`[Icon] ${String(t)}`),c(!0),d(!1)})},[e,o.width,o.height,o.title]),u||n?m("svg",{...o}):m("span",{className:o.className,style:{width:String(o.width),height:String(o.height),display:"inline-flex",lineHeight:0},dangerouslySetInnerHTML:{__html:s}})}function F({source:e,size:o="24",stroke:s="2",viewBox:a="0 0 24 24",className:u,...d}){const n={className:N(["dropin-icon",`dropin-icon--shape-stroke-${s}`,u]),width:o,height:o,viewBox:a},c=typeof e=="string"&&(e.startsWith("http")||e.startsWith("//")||e.startsWith("/"));if(c&&k(e))return m(L,{fallback:m("svg",{...d,...n}),children:m(W,{url:e,...d,...n})});const t=typeof e=="string"&&e in R?R[e]:null,l=c&&!k(e);return m(L,{fallback:m("svg",{...d,...n}),children:t?m(t,{...d,...n}):l?m("svg",{...d,...n}):m(e,{...d,...n})})}const G=({name:e,value:o,size:s="medium",disabled:a=!1,error:u=!1,label:d="",description:n="",className:c,checked:t,...l})=>{const[h,_]=$(t===void 0?!1:t),f=S(null),v=p=>{var g;(g=l.onChange)==null||g.call(l,p),_(p.currentTarget.checked)},V=p=>{var g;p.key===" "&&(p.preventDefault(),(g=f==null?void 0:f.current)==null||g.click())};return D(()=>{typeof t=="boolean"&&_(t)},[t]),P("label",{className:E(["dropin-checkbox",["dropin-checkbox--disabled",a]]),children:[m("input",{ref:f,name:e,value:o,type:"checkbox",disabled:a,className:E(["dropin-checkbox__checkbox",["dropin-checkbox__checkbox--error",u],c]),...l,onChange:v,checked:h}),P("div",{className:"dropin-checkbox__checkbox-icon",children:["â€‹",m("span",{"aria-checked":h?"true":"false","aria-labelledby":`${e}-label`,"aria-describedby":n?`${e}-description`:void 0,className:E(["dropin-checkbox__box",["dropin-checkbox__box--error",u],["dropin-checkbox__box--disabled",a]]),role:"checkbox",tabIndex:a?-1:0,onKeyDown:V,children:m(F,{className:E(["dropin-checkbox__checkmark"]),source:T,size:"16",stroke:"3"})})]}),m("div",{id:`${e}-label`,className:E(["dropin-checkbox__label",`dropin-checkbox__label--${s}`,["dropin-checkbox__label--disabled",a]]),children:d}),m("div",{}),n&&m("div",{id:`${e}-description`,role:"note",className:E(["dropin-checkbox__description",`dropin-checkbox__description--${s}`,["dropin-checkbox__description--disabled",a]]),children:n})]})},A=({className:e,checked:o,name:s,label:a,...u})=>m("div",{...u,className:E(["emailconsent-email-consent-ui-component",e]),children:m(G,{name:s,label:a,checked:o})}),X=({enable_sms_consent:e,enable_email_consent:o,sms_consent_label:s,email_consent_label:a,sms_consent_name:u,email_consent_name:d,checked:n,sms_disclosure:c,...t})=>P("div",{...t,children:[o&&m(A,{label:a,name:d,checked:n}),e&&P("div",{class:"sms-consent",children:[m(A,{label:s,name:u,checked:n}),m("div",{class:"sms-disclosure",children:c})]})]}),Y=async(e,o,s,a,u,d,n)=>{let c=await C(e.email,n),t=null,l=null;if(c.GetProfileByEmail.data.length<=0){let _=I(e,o,null,null,null,!0),f=await w(_,n);Object.keys(f.createProfile).length>0&&(t=f.createProfile.data)}else t=c.GetProfileByEmail.data[0];let h=[];if(t&&Object.keys(t.id).length>0&&(l=t.id),l){if(s){let _=I(e,o,"email",l,a);Object.keys(_).length>0&&h.push(_)}if(u){let _=I(e,o,"sms",l,d);Object.keys(_).length>0&&h.push(_)}if(h.length)for(const _ of h)x(_,n)}return t},z=e=>{let o=null;return e?String(e).replace(/^(\d)/,"+$1").replace(/^\((?!\+)/,"(+"):o},I=(e,o,s,a,u,d=!1)=>{var _,f,v;let n={},c={},t=o.data,l={},h=z(t.telephone);return d&&(l={data:{type:"profile",attributes:{email:e.email||null,phone_number:h||null,first_name:t.firstName||null,last_name:t.lastName||null,organization:t.company||null,location:{address1:((_=t.street)==null?void 0:_[0])||null,address2:((f=t.street)==null?void 0:f[1])||null,city:t.city||null,country:t.countryCode||null,region:((v=t.region)==null?void 0:v.regionCode)||null,zip:t.postcode||null}}}}),d||(s==="email"&&a&&(l={data:{type:"profile-subscription-bulk-create-job",attributes:{profiles:{data:[{type:"profile",id:a,attributes:{email:e.email||null,phone_number:h||null}}]}}}},n.email={marketing:{consent:"SUBSCRIBED"}}),s==="sms"&&a&&(l={data:{type:"profile-subscription-bulk-create-job",attributes:{profiles:{data:[{type:"profile",id:a,attributes:{phone_number:h||null}}]}}}},n.sms={marketing:{consent:"SUBSCRIBED"},transactional:{consent:"SUBSCRIBED"}}),a&&Object.keys(n).length>0&&(l.data.attributes.profiles.data[0].attributes.subscriptions=n),u&&(c.list={data:{type:"list",id:u}}),a&&u&&Object.keys(c.list.data).length>0&&(l.data.relationships=c)),l};export{X as EmailConsentContainer,Y as KlaviyoApiCreateUpdate,X as default};
//# sourceMappingURL=EmailConsentContainer.js.map
